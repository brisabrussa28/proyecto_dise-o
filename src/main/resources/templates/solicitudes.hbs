{{#partial "nav_izquierda"}}
    <a href="/admin/dashboard" class="btn btn-outline-light btn-sm d-flex align-items-center gap-2"
       title="Volver al panel">
        <i class="fa-solid fa-arrow-left"></i>
        <span class="d-none d-sm-block">Volver</span>
    </a>
{{/partial}}

{{#partial "contenido"}}
    <div class="container pb-5">
        <body class="general" style="background-color: white;">
        <h1 class="mt-2 fw-bold">
            <i class="bi bi-clock-history"></i>
            Solicitudes Pendientes
        </h1>

        <div class="card shadow-sm mb-4">
            <div class="card-body p-0">
                <div class="list-group list-group-flush">
                    {{#each solicitudes}}
                        <div class="list-group-item d-flex flex-column"
                             style="border-top: 10px solid #005baa; min-width: 78vw; background-color: white; clip-path: polygon(0 0, 100% 0, 100% calc(100% - 20px), calc(100% - 20px) 100%, 0 100%); "
                             id="{{this.id}}">
                            <div class="d-flex flex-row"
                                 style="justify-content: space-between; flex-wrap: wrap; padding-left: 10px; font-weight: bold;">
                                S-{{this.id}}
                                <div class="d-flex flex-row"
                                     style="padding-right: 20px; padding-top: 10px; gap: 20px;">
                                    <button class="boton btn btn-outline-success"
                                            style="border: 3px solid rgb(0, 192, 0);"
                                            onclick="aceptarSolicitud('{{this.id}}')">
                                        <i class="bi bi-check-lg d-flex align-items-center justify-content-center"></i>
                                    </button>
                                    <button class="boton btn btn-danger"
                                            style="border: 3px solid red;"
                                            onclick="eliminarSolicitud('{{this.id}}')">
                                        <i class="bi-x d-flex align-items-center justify-content-center"></i>
                                    </button>
                                </div>
                            </div>
                            <div style="padding-left: 35px; font-size: 20px; padding-bottom: 10px;">
                                <div style="font-size: 18px; font-weight:500">
                                    <strong class="me-1" style="font-size: 20px;">
                                        Hecho Solicitado:
                                    </strong>
                                    {{this.hechoSolicitado.id}}
                                </div>
                                <div style="font-size: 18px; font-weight:500">
                                    <strong class="me-1" style="font-size: 20px;">
                                        Solicitante:
                                    </strong>
                                    {{this.solicitante}}
                                </div>
                                <div class="d-flex flex-row align-items-start"
                                     style="padding-top: 30px; gap: 15px; style=font-size: 18px; font-weight:500; max-width: 67vw;">
                                    <strong class="me-1" style="font-size: 20px;">
                                        Descripci√≥n:
                                    </strong>
                                    <div class="descripcion-pre-formateada"
                                         style="font-size: 18px; font-weight:500; display: block; max-width: 60vw;">
                                        {{this.razonEliminacion}}
                                    </div>
                                </div>
                            </div>
                        </div>
                    {{else}}
                        <div class="text-muted p-2 text-begin" style="font-weight:">No hay solicitudes.</div>
                    {{/each}}
                </div>
            </div>
        </div>
        </body>
    </div>

    <script>
        async function eliminarSolicitud(idDelElemento) {
            try {
                const response = await fetch(`/admin/solicitudes?id=${idDelElemento}&aceptada=false`, {
                    method: "PUT"
                });
                if (response.ok) {
                    const solicitudAEliminar = document.getElementById(idDelElemento);
                    if (solicitudAEliminar) {
                        solicitudAEliminar.remove();
                        console.log("Solicitud " + idDelElemento + " rechazada y eliminada.");
                    }
                } else {
                    const errorText = await response.text();
                    console.error("Error al rechazar solicitud:", errorText);
                    alert("No se pudo rechazar la solicitud: " + errorText);
                }
            } catch (err) {
                console.error("Error de red:", err);
            }
        }
        async function aceptarSolicitud(idDelElemento) {
            try {
                const response = await fetch(`/admin/solicitudes?id=${idDelElemento}&aceptada=true`, {
                    method: "PUT"
                });
                if (response.ok) {
                    const solicitudAEliminar = document.getElementById(idDelElemento);
                    if (solicitudAEliminar) {
                        solicitudAEliminar.remove();
                        console.log("Solicitud " + idDelElemento + " aceptada y eliminada.");
                    }
                } else {
                    const errorText = await response.text();
                    console.error("Error al aceptar solicitud:", errorText);
                    alert("No se pudo aceptar la solicitud: " + errorText);
                }
            } catch (err) {
                console.error("Error de red:", err);
            }
        }
    </script>
{{/partial}}

{{> templates/layout}}
